{% extends "reference/base.html" %}
{% load static %}

{% block title %}{{ season.name }} - TagPro Reference{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'reference/styles/season.css' %}">

{% endblock %}

{% block content %}
<h1 class="page-title">
    {% if season.league.logo %}
        <img src="/static/reference/{{ season.league.logo }}" alt="{{ season.league.name }} logo" class="league-logo">
    {% endif %}
    {{ season.name }}
</h1>

<div class="season-selector">
    <label for="season-dropdown">Switch Season: </label>
    <select id="season-dropdown" onchange="changeSeason(this.value)">
        {% for league_season in league_seasons %}
            <option value="{{ league_season.id }}" {% if league_season.id == season.id %}selected{% endif %}>
                {{ league_season.name }}
            </option>
        {% endfor %}
    </select>
</div>

<div class="season-nav">
    <span class="current">Home</span> |
    <a href="{% url 'season_schedule' season.id %}">Schedule</a> |
    <a href="{% url 'season_stats' season.id %}">Stats</a> |
    <a href="{% url 'season_rosters' season.id %}">Rosters</a> |
    <a href="{% url 'league_history' season.league.id %}">History</a>
</div>

<div class="stat-table-container">
    <table class="stat-table">
        <thead>
            <tr>
                <th data-sortable data-type="number">Rank</th>
                <th class="logo-col" data-sortable data-type="text"></th>
                <th class="team-name" data-sortable data-type="text">Team</th>
                <th data-sortable data-type="number">GP</th>
                <th data-sortable data-type="number">Pts</th>
                <th data-sortable data-type="number">W</th>
                <th data-sortable data-type="number">OTW</th>
                <th data-sortable data-type="number">OTL</th>
                <th data-sortable data-type="number">L</th>
                <th data-sortable data-type="number">CF</th>
                <th data-sortable data-type="number">CA</th>
                <th data-sortable data-type="number">Diff</th>
            </tr>
        </thead>
        <tbody>
            {% for standing in standings %}
            <tr>
                <td class="rank-col">{{ standing.rank }}</td>
                <td class="logo-col">
                    {% if standing.team.franchise.logo %}
                        <img src="/static/reference/{{ standing.team.franchise.logo }}" alt="{{ standing.team.franchise.name }} logo" class="team-logo-small">
                    {% endif %}
                </td>
                <td class="team-name">
                    <a href="{% url 'team_season' standing.team.id %}">
                        {{ standing.team.name }}
                    </a>
                </td>
                <td>{{ standing.games_played }}</td>
                <td><strong>{{ standing.standing_points }}</strong></td>
                <td>{{ standing.wins }}</td>
                <td>{{ standing.ot_wins }}</td>
                <td>{{ standing.ot_losses }}</td>
                <td>{{ standing.losses }}</td>
                <td>{{ standing.caps_for }}</td>
                <td>{{ standing.caps_against }}</td>
                <td class="{% if standing.cap_differential > 0 %}positive{% elif standing.cap_differential < 0 %}negative{% else %}zero{% endif %}">
                    {{ standing.cap_differential|stringformat:"+d" }}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="12" style="text-align: center; padding: 30px; color: #6c757d;">
                    No teams found for this season.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'reference/js/table-sort.js' %}"></script>
<script>
    function changeSeason(seasonId) {
        if (seasonId) {
            window.location.href = `/season/${seasonId}/`;
        }
    }
    
    // Initialize table sorting when page loads
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize sortable table with default sort by Pts (column 4) descending
        initTableSort('.stat-table', {
            initialSort: { column: 0, direction: 'asc' }
        });
    });
</script>
{% endblock %}