{% extends "reference/base.html" %}
{% load static %}

{% block title %}{{ season.name }} Schedule - TagPro Reference{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'reference/styles/season.css' %}">
<link rel="stylesheet" href="{% static 'reference/styles/schedule.css' %}">
{% endblock %}

{% block content %}

    <h1 class="page-title">{{ season.name }} Schedule</h1>
        
        <div class="season-selector">
            <label for="season-dropdown">Switch Season: </label>
            <select id="season-dropdown" onchange="changeSeason(this.value)">
                {% for league_season in league_seasons %}
                    <option value="{{ league_season.id }}" {% if league_season.id == season.id %}selected{% endif %}>
                        {{ league_season.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        
        <div class="season-nav">
            <a href="{% url 'season_home' season.id %}">Home</a> |
            <span class="current">Schedule</span> |
            <a href="{% url 'season_stats' season.id %}">Stats</a> |
            <a href="{% url 'season_rosters' season.id %}">Rosters</a>
        </div>
        
        {% for week_data in schedule_data %}
        <div class="week-section">
            <h2 class="week-title">{{ week_data.week }}</h2>
            
            <div class="matches-container">
                {% for match_data in week_data.matches %}
                <div class="match-box">
                    <div class="match-date"><a href="{% url 'match_view' match_data.match.id %}">{{ match_data.match.date|date:"n/j" }}</a></div>
                    
                    {% if match_data.has_games %}
                    <table class="box-score">
                        <colgroup>
                            <col>
                            {% for game in match_data.games %}
                            <col style="width: 2rem">
                            {% endfor %}
                            <col style="width: 2.5rem">
                        </colgroup>
                        <thead>
                            <tr>
                                <th>Team</th>
                                {% for game in match_data.games %}
                                <th>G{{ forloop.counter }}</th>
                                {% endfor %}
                                <th>Pts</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="team-name-cell">
                                    <a href="{% url 'team_season' match_data.match.team1.id %}">
                                        {{ match_data.match.team1.name }}
                                    </a>
                                </td>
                                {% for game in match_data.games %}
                                <td class="{% if game.winner == 'team1' %}winning-score{% endif %}">
                                    {{ game.team1_score }}{% if game.is_overtime and game.winner == 'team1' %}<span class="overtime">O</span>{% endif %}
                                </td>
                                {% endfor %}
                                <td class="{% if match_data.match_winner == 'team1' %}winning-total{% endif %}">
                                    <strong>{{ match_data.team1_total }}</strong>
                                </td>
                            </tr>
                            <tr>
                                <td class="team-name-cell">
                                    <a href="{% url 'team_season' match_data.match.team2.id %}">
                                        {{ match_data.match.team2.name }}
                                    </a>
                                </td>
                                {% for game in match_data.games %}
                                <td class="{% if game.winner == 'team2' %}winning-score{% endif %}">
                                    {{ game.team2_score }}{% if game.is_overtime and game.winner == 'team2' %}<span class="overtime">O</span>{% endif %}
                                </td>
                                {% endfor %}
                                <td class="{% if match_data.match_winner == 'team2' %}winning-total{% endif %}">
                                    <strong>{{ match_data.team2_total }}</strong>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    {% else %}
                    <div class="no-games-match">
                        <div class="no-games-teams">
                            <a href="{% url 'team_season' match_data.match.team1.id %}">{{ match_data.match.team1.name }}</a>
                            <br>vs<br>
                            <a href="{% url 'team_season' match_data.match.team2.id %}">{{ match_data.match.team2.name }}</a>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% empty %}
        <div style="text-align: center; padding: 3rem; color: #6c757d;">
            No matches scheduled for this season.
        </div>
        {% endfor %}
{% endblock %}

{% block extra_js %}
<script>
    function changeSeason(seasonId) {
        if (seasonId) {
            window.location.href = `/season/${seasonId}/schedule/`;
        }
    }
</script>
{% endblock %}